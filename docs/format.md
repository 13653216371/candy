# 消息格式

## 握手包

仅由客户端发送给服务端,服务端不产生任何响应.如果握手包有效,将等级 TUN IP 与 WebSocket 的映射,当其他设备访问该客户端时将收到 IP 报文.

- 报文中应包含 Type 字段,用于区分报文类型,占用 1 个字节(8 位)
- 报文中应包含 TUN IP 字段.用于建立目的地址与 WebSocket 之间的映射,占用 4 个字节(32 位)
- 报文中应包含 TimeStamp 字段,检查握手时间避免重放攻击.占用 8 个字节(64 位)
- 报文中应包含 Hash 字段,用于身份验证.占用 32 个字节(256 位). Hash 值由 TimeStamp 和服务端配置的口令生成
- 报文中可以包含混淆字段,占用随机字节数,并随机填充字节.用来隐藏握手包固定长度的特征.

## IP 报文转发包

客户端和服务端相互发送,客户端从 TUN 读到数据后转发给 Server, 收到 Server 数据后转发给 TUN. Server 收到报文后分析源地址 IP, 校验 IP 与 Websocket 是否已经建立映射, 获取目的地址 IP, 并将报文转发给对应的 WebSocket.

- 报文中应包含 Type 字段,用于区分报文类型,占用 1 个字节(8 位)
- 报文中应包含 IP 层原始数据
